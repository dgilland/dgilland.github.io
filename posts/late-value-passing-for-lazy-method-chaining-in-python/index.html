<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns#
article: http://ogp.me/ns/article#
" lang="en">
    <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Late Value Passing for Lazy Method Chaining in Python | Derrick Gilland</title>

                <link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">

                <link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">

      <link rel="canonical" href="http://derrickgilland.com/posts/late-value-passing-for-lazy-method-chaining-in-python/">

            <link rel="icon" href="../../assets/img/favicon-32x32.png" sizes="32x32">
            <link rel="icon" href="../../assets/img/favicon-192x192.png" sizes="192x192">
            <link rel="icon" href="../../favicon.ico" sizes="16x16">
            <link rel="icon" href="../../assets/img/favicon-96x96.png" sizes="96x96">
            <link rel="icon" href="../../assets/img/favicon-160x160.png" sizes="160x160">



    
        <!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]-->

    

    
    <meta name="author" content="Derrick Gilland">
        <link rel="prev" href="../pydash-release-v320/" title="pydash: Release v3.2.0" type="text/html">
        <link rel="next" href="../new-project-pushjack/" title="New Project: pushjack" type="text/html">
        <meta property="og:site_name" content="Derrick Gilland">
    <meta property="og:title" content="Late Value Passing for Lazy Method Chaining in Python">
    <meta property="og:url" content="http://derrickgilland.com/posts/late-value-passing-for-lazy-method-chaining-in-python/">
    <meta property="og:description" content="This is part three in my series on Generative Classes.
In part two of this series, Lazy Method Chaining in Python, I showed an example of how to implement lazy method chaining. In this post I will bui">
    <meta property="og:type" content="article">
    <meta property="article:published_time" content="2015-03-18T17:43:34-04:00">
           <meta property="article:tag" content="generative-classes">
           <meta property="article:tag" content="pydash">
           <meta property="article:tag" content="python">

    
    

<link href="http://fonts.googleapis.com/css?family=Source+Code+Pro:400,700%7CMerriweather:400,500%7CRaleway:400,500" rel="stylesheet" type="text/css">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://derrickgilland.com/">

                <span id="blog-title">Derrick Gilland</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                                <li>
<a href="../../"><i class="fa fa-home fa-lg"></i></a>
                </li>
<li>
<a href="../../pages/about/">About</a>
                </li>
<li>
<a href="../../pages/projects/">Projects</a>
                </li>
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>

            <ul class="nav navbar-nav navbar-right">
                                    <li>
<a href="https://github.com/dgilland"><i class="fa fa-github fa-lg"></i></a>
                </li>
<li>
<a href="http://stackoverflow.com/users/681166/dgilland"><i class="fa fa-stack-overflow fa-lg"></i></a>
                </li>
<li>
<a href="mailto:dgilland@gmail.com"><i class="fa fa-envelope fa-lg"></i></a>
                </li>
<li>
<a href="../../rss.xml"><i class="fa fa-rss fa-lg"></i></a>

                
            </li>
</ul>
        </div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav>

<!-- End of Menubar -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article">
        <header>
            <h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url" rel="bookmark">Late Value Passing for Lazy Method Chaining in Python</a></h1>

        <div class="metadata">
            <p class="dateline"><time class="published dt-published" datetime="2015-03-18T17:43:34-04:00" itemprop="datePublished" title="March 18, 2015">March 18, 2015</time></p>
                <p class="commentline">            <a href=".#disqus_thread" data-disqus-identifier="cache/posts/late-value-passing-for-lazy-method-chaining-in-python.html">Comments</a>


            
        </p>
</div>
        
    </header>

    <div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>This is part three in my series on <a class="reference external" href="../../categories/generative-classes/">Generative Classes</a>.</p>
<p>In part two of this series, <a class="reference external" href="../lazy-method-chaining-in-python">Lazy Method Chaining in Python</a>, I showed an example of how to implement lazy method chaining. In this post I will build upon that implementation by building support for a way to pass the seed value of the lazy method chain late, i.e., at the end of the chain instead of at the beginning. This will then allow us to easily create reusable ad-hoc functions from chained methods.</p>
<p>The example code I will use to discuss this type of functionality can be found in <a class="reference external" href="http://pydash.readthedocs.org/en/latest/">pydash's</a> <a class="reference external" href="https://github.com/dgilland/pydash/blob/44ff5f94870be48908c8b1eb1623559b88164dad/pydash/chaining.py">chaining submodule</a>:</p>
<!-- TEASER_END -->
<pre class="code python"><a name="rest_code_be1c5dff68334cb390babc79df4863ed-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-2"></a>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-3"></a><span class="kn">import</span> <span class="nn">pydash</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-4"></a><span class="kn">from</span> <span class="nn">.helpers</span> <span class="kn">import</span> <span class="n">NoValue</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-5"></a>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-6"></a>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-7"></a><span class="k">class</span> <span class="nc">Chain</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-8"></a>    <span class="sd">"""Enables chaining of 'module' functions."""</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-9"></a>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-10"></a>    <span class="c">#: Object that contains attribute references to available methods.</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-11"></a>    <span class="n">module</span> <span class="o">=</span> <span class="n">pydash</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-12"></a>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-13"></a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">NoValue</span><span class="p">):</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-14"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">value</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-15"></a>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-16"></a>    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-17"></a>        <span class="sd">"""Return current value of the chain operations."""</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-18"></a>        <span class="k">return</span> <span class="bp">self</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-19"></a>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-20"></a>    <span class="nd">@classmethod</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-21"></a>    <span class="k">def</span> <span class="nf">get_method</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-22"></a>        <span class="sd">"""Return valid 'module' method."""</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-23"></a>        <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">cls</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-24"></a>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-25"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">method</span><span class="p">):</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-26"></a>            <span class="k">raise</span> <span class="n">cls</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">InvalidMethod</span><span class="p">((</span><span class="s">'Invalid pydash method: {0}'</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-27"></a>                                            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)))</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-28"></a>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-29"></a>        <span class="k">return</span> <span class="n">method</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-30"></a>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-31"></a>    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-32"></a>        <span class="sd">"""Proxy attribute access to 'module'."""</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-33"></a>        <span class="k">return</span> <span class="n">ChainWrapper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_method</span><span class="p">(</span><span class="n">attr</span><span class="p">))</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-34"></a>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-35"></a>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-36"></a>        <span class="sd">"""Return result of passing 'value' through chained methods."""</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-37"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">,</span> <span class="n">ChainWrapper</span><span class="p">):</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-38"></a>            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-39"></a>        <span class="k">return</span> <span class="n">value</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-40"></a>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-41"></a>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-42"></a><span class="k">class</span> <span class="nc">ChainWrapper</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-43"></a>    <span class="sd">"""Wrap 'Chain' method call within a 'ChainWrapper' context."""</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-44"></a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-45"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">value</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-46"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">method</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-47"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="p">()</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-48"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">kargs</span> <span class="o">=</span> <span class="p">{}</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-49"></a>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-50"></a>    <span class="k">def</span> <span class="nf">_generate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-51"></a>        <span class="sd">"""Generate a copy of this instance."""</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-52"></a>        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">)</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-53"></a>        <span class="n">new</span><span class="o">.</span><span class="n">__dict__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-54"></a>        <span class="k">return</span> <span class="n">new</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-55"></a>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-56"></a>    <span class="k">def</span> <span class="nf">unwrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">NoValue</span><span class="p">):</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-57"></a>        <span class="sd">"""Execute 'method' with '_value', 'args', and 'kargs'. If '_value' is</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-58"></a><span class="sd">        an instance of 'ChainWrapper', then unwrap it before calling 'method'.</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-59"></a><span class="sd">        """</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-60"></a>        <span class="c"># Generate a copy of ourself so that we don't modify the chain wrapper</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-61"></a>        <span class="c"># _value directly. This way if we are late passing a value, we don't</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-62"></a>        <span class="c"># "freeze" the chain wrapper value when a value is first passed.</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-63"></a>        <span class="c"># Otherwise, we'd locked the chain wrapper value permanently and not be</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-64"></a>        <span class="c"># able to reuse it.</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-65"></a>        <span class="n">wrapper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate</span><span class="p">()</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-66"></a>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-67"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wrapper</span><span class="o">.</span><span class="n">_value</span><span class="p">,</span> <span class="n">ChainWrapper</span><span class="p">):</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-68"></a>            <span class="n">wrapper</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">wrapper</span><span class="o">.</span><span class="n">_value</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-69"></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">ChainWrapper</span><span class="p">)</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NoValue</span><span class="p">:</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-70"></a>            <span class="c"># Override wrapper's initial value.</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-71"></a>            <span class="n">wrapper</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">value</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-72"></a>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-73"></a>        <span class="k">if</span> <span class="n">wrapper</span><span class="o">.</span><span class="n">_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NoValue</span><span class="p">:</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-74"></a>            <span class="n">value</span> <span class="o">=</span> <span class="n">wrapper</span><span class="o">.</span><span class="n">_value</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-75"></a>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-76"></a>        <span class="k">return</span> <span class="n">wrapper</span><span class="o">.</span><span class="n">method</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="o">*</span><span class="n">wrapper</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">wrapper</span><span class="o">.</span><span class="n">kargs</span><span class="p">)</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-77"></a>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-78"></a>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-79"></a>        <span class="sd">"""Invoke the 'method' with 'value' as the first argument and return a</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-80"></a><span class="sd">        new 'Chain' object with the return value.</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-81"></a><span class="sd">        """</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-82"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-83"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">kargs</span> <span class="o">=</span> <span class="n">kargs</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-84"></a>        <span class="k">return</span> <span class="n">Chain</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-85"></a>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-86"></a>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-87"></a><span class="k">def</span> <span class="nf">chain</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-88"></a>    <span class="sd">"""Creates a 'Chain' object which wraps the given value to enable</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-89"></a><span class="sd">    intuitive method chaining. Chaining is lazy and won't compute a final value</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-90"></a><span class="sd">    until 'Chain.value' is called.</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-91"></a><span class="sd">    """</span>
<a name="rest_code_be1c5dff68334cb390babc79df4863ed-92"></a>    <span class="k">return</span> <span class="n">Chain</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</pre>
<p><strong>NOTE:</strong> The code above has been simplified for illustrative purposes.</p>
<div class="section" id="usage">
<h2>Usage</h2>
<p>Early value passing should look familiar:</p>
<pre class="code python"><a name="rest_code_e8e1fb08e3184663be754ccad7c0eb8c-1"></a><span class="n">chained</span> <span class="o">=</span> <span class="n">Chain</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a name="rest_code_e8e1fb08e3184663be754ccad7c0eb8c-2"></a><span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">chained</span><span class="p">,</span> <span class="n">Chain</span><span class="p">)</span>
<a name="rest_code_e8e1fb08e3184663be754ccad7c0eb8c-3"></a>
<a name="rest_code_e8e1fb08e3184663be754ccad7c0eb8c-4"></a><span class="c"># NOTE: No actual function calls have been executed for power() or sum() yet.</span>
<a name="rest_code_e8e1fb08e3184663be754ccad7c0eb8c-5"></a><span class="c"># The chaining is lazy until value() is called.</span>
<a name="rest_code_e8e1fb08e3184663be754ccad7c0eb8c-6"></a>
<a name="rest_code_e8e1fb08e3184663be754ccad7c0eb8c-7"></a><span class="n">results</span> <span class="o">=</span> <span class="n">chained</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
<a name="rest_code_e8e1fb08e3184663be754ccad7c0eb8c-8"></a><span class="k">assert</span> <span class="n">results</span> <span class="o">==</span> <span class="mi">30</span>
</pre>
<p>Late value passing is almost identical except for how the value is passed in and the fact that the chain function can be reused:</p>
<pre class="code python"><a name="rest_code_51e3842a5880402186b82f37664f6e76-1"></a><span class="n">square_sum</span> <span class="o">=</span> <span class="n">Chain</span><span class="p">()</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a name="rest_code_51e3842a5880402186b82f37664f6e76-2"></a><span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">square_sum</span><span class="p">,</span> <span class="n">Chain</span><span class="p">)</span>
<a name="rest_code_51e3842a5880402186b82f37664f6e76-3"></a>
<a name="rest_code_51e3842a5880402186b82f37664f6e76-4"></a><span class="n">results</span> <span class="o">=</span> <span class="n">square_sum</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<a name="rest_code_51e3842a5880402186b82f37664f6e76-5"></a><span class="k">assert</span> <span class="n">results</span> <span class="o">==</span> <span class="mi">30</span>
<a name="rest_code_51e3842a5880402186b82f37664f6e76-6"></a>
<a name="rest_code_51e3842a5880402186b82f37664f6e76-7"></a><span class="n">results</span> <span class="o">=</span> <span class="n">square_sum</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
<a name="rest_code_51e3842a5880402186b82f37664f6e76-8"></a><span class="k">assert</span> <span class="n">results</span> <span class="o">=</span> <span class="mi">174</span>
</pre>
</div>
<div class="section" id="breakdown">
<h2>Breakdown</h2>
<p>The main difference between our first lazy chaining implementation and our new late-value implementation is in the <tt class="docutils literal">ChainWrapper.unwrap</tt> method.</p>
<p>The original implementation:</p>
<pre class="code python"><a name="rest_code_53ff1c9c25974eb0967dbcf23f0d72af-1"></a><span class="k">class</span> <span class="nc">ChainWrapper</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a name="rest_code_53ff1c9c25974eb0967dbcf23f0d72af-2"></a>    <span class="sd">"""Wrap pydash method call within a ChainWrapper context."""</span>
<a name="rest_code_53ff1c9c25974eb0967dbcf23f0d72af-3"></a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
<a name="rest_code_53ff1c9c25974eb0967dbcf23f0d72af-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">value</span>
<a name="rest_code_53ff1c9c25974eb0967dbcf23f0d72af-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">method</span>
<a name="rest_code_53ff1c9c25974eb0967dbcf23f0d72af-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="p">()</span>
<a name="rest_code_53ff1c9c25974eb0967dbcf23f0d72af-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">kargs</span> <span class="o">=</span> <span class="p">{}</span>
<a name="rest_code_53ff1c9c25974eb0967dbcf23f0d72af-8"></a>
<a name="rest_code_53ff1c9c25974eb0967dbcf23f0d72af-9"></a>    <span class="k">def</span> <span class="nf">unwrap</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_53ff1c9c25974eb0967dbcf23f0d72af-10"></a>        <span class="sd">"""Execute method with _value, args, and kargs. If _value is an</span>
<a name="rest_code_53ff1c9c25974eb0967dbcf23f0d72af-11"></a><span class="sd">        instance of ChainWrapper, then unwrap it before calling method.</span>
<a name="rest_code_53ff1c9c25974eb0967dbcf23f0d72af-12"></a><span class="sd">        """</span>
<a name="rest_code_53ff1c9c25974eb0967dbcf23f0d72af-13"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">,</span> <span class="n">ChainWrapper</span><span class="p">):</span>
<a name="rest_code_53ff1c9c25974eb0967dbcf23f0d72af-14"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="o">.</span><span class="n">unwrap</span><span class="p">()</span>
<a name="rest_code_53ff1c9c25974eb0967dbcf23f0d72af-15"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kargs</span><span class="p">)</span>
<a name="rest_code_53ff1c9c25974eb0967dbcf23f0d72af-16"></a>
<a name="rest_code_53ff1c9c25974eb0967dbcf23f0d72af-17"></a>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
<a name="rest_code_53ff1c9c25974eb0967dbcf23f0d72af-18"></a>        <span class="sd">"""Invoke the method with value as the first argument and return a new</span>
<a name="rest_code_53ff1c9c25974eb0967dbcf23f0d72af-19"></a><span class="sd">        Chain object with the return value.</span>
<a name="rest_code_53ff1c9c25974eb0967dbcf23f0d72af-20"></a><span class="sd">        """</span>
<a name="rest_code_53ff1c9c25974eb0967dbcf23f0d72af-21"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
<a name="rest_code_53ff1c9c25974eb0967dbcf23f0d72af-22"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">kargs</span> <span class="o">=</span> <span class="n">kargs</span>
<a name="rest_code_53ff1c9c25974eb0967dbcf23f0d72af-23"></a>        <span class="k">return</span> <span class="n">Chain</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre>
<p>The <tt class="docutils literal">unwrap</tt> method in the original was very simple. If the underlying <tt class="docutils literal">self._value</tt> was an instance of <tt class="docutils literal">ChainWrapper</tt>, then it would be recursively unwrapped until the root value was reached. Then the root value would be passed back through the <tt class="docutils literal">ChainWrapper</tt>'s for the final value calculation.</p>
<p>The late-value implementation:</p>
<pre class="code python"><a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-1"></a><span class="k">class</span> <span class="nc">ChainWrapper</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-2"></a>    <span class="sd">"""Wrap 'Chain' method call within a 'ChainWrapper' context.</span>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-3"></a><span class="sd">    """</span>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-4"></a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">value</span>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">method</span>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="p">()</span>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">kargs</span> <span class="o">=</span> <span class="p">{}</span>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-9"></a>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-10"></a>    <span class="k">def</span> <span class="nf">_generate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-11"></a>        <span class="sd">"""Generate a copy of this instance."""</span>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-12"></a>        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">)</span>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-13"></a>        <span class="n">new</span><span class="o">.</span><span class="n">__dict__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-14"></a>        <span class="k">return</span> <span class="n">new</span>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-15"></a>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-16"></a>    <span class="k">def</span> <span class="nf">unwrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">NoValue</span><span class="p">):</span>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-17"></a>        <span class="sd">"""Execute 'method' with '_value', 'args', and 'kargs'. If '_value' is</span>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-18"></a><span class="sd">        an instance of 'ChainWrapper', then unwrap it before calling 'method'.</span>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-19"></a><span class="sd">        """</span>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-20"></a>        <span class="c"># Generate a copy of ourself so that we don't modify the chain wrapper</span>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-21"></a>        <span class="c"># _value directly. This way if we are late passing a value, we don't</span>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-22"></a>        <span class="c"># "freeze" the chain wrapper value when a value is first passed.</span>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-23"></a>        <span class="c"># Otherwise, we'd locked the chain wrapper value permanently and not be</span>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-24"></a>        <span class="c"># able to reuse it.</span>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-25"></a>        <span class="n">wrapper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate</span><span class="p">()</span>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-26"></a>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-27"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wrapper</span><span class="o">.</span><span class="n">_value</span><span class="p">,</span> <span class="n">ChainWrapper</span><span class="p">):</span>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-28"></a>            <span class="n">wrapper</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">wrapper</span><span class="o">.</span><span class="n">_value</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-29"></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">ChainWrapper</span><span class="p">)</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NoValue</span><span class="p">:</span>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-30"></a>            <span class="c"># Override wrapper's initial value.</span>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-31"></a>            <span class="n">wrapper</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">value</span>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-32"></a>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-33"></a>        <span class="k">if</span> <span class="n">wrapper</span><span class="o">.</span><span class="n">_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NoValue</span><span class="p">:</span>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-34"></a>            <span class="n">value</span> <span class="o">=</span> <span class="n">wrapper</span><span class="o">.</span><span class="n">_value</span>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-35"></a>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-36"></a>        <span class="k">return</span> <span class="n">wrapper</span><span class="o">.</span><span class="n">method</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="o">*</span><span class="n">wrapper</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">wrapper</span><span class="o">.</span><span class="n">kargs</span><span class="p">)</span>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-37"></a>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-38"></a>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-39"></a>        <span class="sd">"""Invoke the 'method' with 'value' as the first argument and return a</span>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-40"></a><span class="sd">        new 'Chain' object with the return value.</span>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-41"></a><span class="sd">        """</span>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-42"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-43"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">kargs</span> <span class="o">=</span> <span class="n">kargs</span>
<a name="rest_code_3f82b08dd4484dfebeb2f38b3f816f5f-44"></a>        <span class="k">return</span> <span class="n">Chain</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre>
<p>Now, the <tt class="docutils literal">unwrap</tt> method has become a little more complex. In order to be reusable, the <tt class="docutils literal">ChainWrapper</tt> instance is cloned using the <tt class="docutils literal">_generate</tt> method. This method should look familiar; it was introduced in part one of this series, <a class="reference external" href="../introduction-to-generative-classes-in-python">Introduction to Generative Classes in Python</a>. After cloning we then check whether the underlying <tt class="docutils literal">wrapper._value</tt> is an instance of <tt class="docutils literal">ChainWrapper</tt> so we can unwrap it to ultimately reach the start of the chain. Once the start of the chain is reached, the passed in <tt class="docutils literal">value</tt> is seeded as the root value. Then the root value is passed through the chain just like in the original implementation. To facilitate the late value passing in the main <tt class="docutils literal">Chain</tt> class, a <tt class="docutils literal">__call__</tt> method was added which accepts a passed in value to use as the root value of the chain. With the new late value passing feature, the lazy chaining implementation now supports ad-hoc function creation via chaining syntax.</p>
<p>In part four of this series, I will investigate implementing a <tt class="docutils literal">plant</tt> method for <tt class="docutils literal">Chain</tt> which will supplant a new initial value as the wrapped value and return a clone of the chain.</p>
<div class="section" id="generative-classes-series">
<h3>Generative Classes Series</h3>
<ul class="simple">
<li>Part one: <a class="reference external" href="../introduction-to-generative-classes-in-python">Introduction to Generative Classes in Python</a>
</li>
<li>Part two: <a class="reference external" href="../lazy-method-chaining-in-python">Lazy Method Chaining in Python</a>
</li>
<li>Part three: <a class="reference external" href="../late-value-passing-for-lazy-method-chaining-in-python">Late Value Passing for Lazy Method Chaining in Python</a>
</li>
<li>Part four: <a class="reference external" href="../reinitializing-chained-method-values-in-python">Reinitializing Chained Method Values in Python</a>
</li>
</ul>
</div>
</div>
</div>
    </div>
    <aside class="postpromonav">
    <nav>
            <ul itemprop="keywords" class="tags">
           <li><a class="tag p-category" href="../../categories/generative-classes/" rel="tag">generative-classes</a></li>
           <li><a class="tag p-category" href="../../categories/pydash/" rel="tag">pydash</a></li>
           <li><a class="tag p-category" href="../../categories/python/" rel="tag">python</a></li>
        </ul>

            <ul class="pager">
            <li class="previous">
                <a href="../pydash-release-v320/" rel="prev" title="pydash: Release v3.2.0">Previous post</a>
            </li>
            <li class="next">
                <a href="../new-project-pushjack/" rel="next" title="New Project: pushjack">Next post</a>
            </li>
        </ul>

    </nav>
    </aside>
        <section class="comments">
        <h2>Comments</h2>
                        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="derrickgilland",
            disqus_url="http://derrickgilland.com/posts/late-value-passing-for-lazy-method-chaining-in-python/",
        disqus_title="Late Value Passing for Lazy Method Chaining in Python",
        disqus_identifier="cache/posts/late-value-passing-for-lazy-method-chaining-in-python.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="//disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section>
    
</article>
               <script>var disqus_shortname="derrickgilland";(function(){var a=document.createElement("script");a.async=true;a.src="//"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>


        </div>
        <!--End of body content-->

        <footer>
            <a href="mailto:dgilland@gmail.com">Derrick Gilland</a> - Blog powered by <a href="http://getnikola.com" rel="nofollow">Nikola</a> 
            
        </footer>
    </div>
</div>

            <script src="../../assets/js/all-nocdn.js"></script>
    

    <script>jQuery("a.image-reference,!.islink").colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script>
    <!-- fancy dates -->
    <script>
    moment.locale("");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script>
    <!-- end fancy dates -->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-58266216-1', 'auto');
  ga('send', 'pageview');

</script>


</body>
</html>
